<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate the consumed biomass in [t] of prey j by predator i. — calculate_consumed_biomass • atlantistools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate the consumed biomass in [t] of prey j by predator i. — calculate_consumed_biomass" />
<meta property="og:description" content="Consumption data is extracted from output[...]PROD.nc. Age based groups
are stored as &quot;Eat_&quot; non age based groups as &quot;Grazing_&quot;. Units are mg N m^-3 d^-1.
Factors are species, time, box and agecl (if present). We will refer to species as
pred from here on to indicate the predator perspective.
Diet contribution data is extracted from DietCheck.txt. Currently this only works
for models based on the trunk code. Units are 
The consumed biomass is calculated as follows:
- Calculate consumed biomass as Eat (or Grazing) * boxvolume per time, pred, agecl, box.
- Convert to biomass in [t].
- Combine with diet contributions and calculate consumed biomass of prey species." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">atlantistools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/atlantistools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/model-calibration-species.html">model-calibration-species</a>
    </li>
    <li>
      <a href="../articles/model-calibration.html">model-calibration</a>
    </li>
    <li>
      <a href="../articles/model-comparison.html">model-comparison</a>
    </li>
    <li>
      <a href="../articles/model-preprocess.html">model-preprocess</a>
    </li>
    <li>
      <a href="../articles/package-demo.html">package-demo</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Atlantis-Ecosystem-Model/atlantistools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate the consumed biomass in [t] of prey j by predator i.</h1>
    <small class="dont-index">Source: <a href='https://github.com/Atlantis-Ecosystem-Model/atlantistools/blob/master/R/calculate-consumed-biomass.R'><code>R/calculate-consumed-biomass.R</code></a></small>
    <div class="hidden name"><code>calculate_consumed_biomass.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Consumption data is extracted from output[...]PROD.nc. Age based groups
are stored as "Eat_" non age based groups as "Grazing_". Units are mg N m^-3 d^-1.
Factors are species, time, box and agecl (if present). We will refer to species as
pred from here on to indicate the predator perspective.
Diet contribution data is extracted from DietCheck.txt. Currently this only works
for models based on the trunk code. Units are <!-- % diet contribution. Factors are pred, time, agecl, prey. -->
The consumed biomass is calculated as follows:
- Calculate consumed biomass as Eat (or Grazing) * boxvolume per time, pred, agecl, box.
- Convert to biomass in [t].
- Combine with diet contributions and calculate consumed biomass of prey species.</p>
    </div>

    <pre class="usage"><span class='fu'>calculate_consumed_biomass</span><span class='op'>(</span><span class='va'>eat</span>, <span class='va'>grazing</span>, <span class='va'>dm</span>, <span class='va'>vol</span>, <span class='va'>bio_conv</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>eat</th>
      <td><p>Dataframe with information about consumption for age-based groups.
Should be generated with <code><a href='load_nc.html'>load_nc</a></code>.</p></td>
    </tr>
    <tr>
      <th>grazing</th>
      <td><p>Dataframe with information about consumption for non-age-based groups.
Should be generated with <code><a href='load_nc.html'>load_nc</a></code>.</p></td>
    </tr>
    <tr>
      <th>dm</th>
      <td><p>Dataframe with information about diet contributions per predator.
Should be generated with <code><a href='load_dietcheck.html'>load_dietcheck</a></code> using <code>convert_names = TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>vol</th>
      <td><p>Dataframe with information about volume per polygon and layer.
Should be generated with <code><a href='load_nc_physics.html'>load_nc_physics</a></code>.</p></td>
    </tr>
    <tr>
      <th>bio_conv</th>
      <td><p>Numeric value to transform weight in mg N to tonnes.
Should be generated with <code><a href='get_conv_mgnbiot.html'>get_conv_mgnbiot</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Dataframe with columns 'pred', 'agecl', 'polygon', 'time', 'prey'.
Consumed biomass in [t] is stored in column 'atoutput'.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># 1. Using built-in datasets.</span>
<span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>, <span class='st'>"setas-model-new-trunk"</span>, package <span class='op'>=</span> <span class='st'>"atlantistools"</span><span class='op'>)</span>
<span class='va'>prm_biol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>d</span>, <span class='st'>"VMPA_setas_biol_fishing_Trunk.prm"</span><span class='op'>)</span>

<span class='va'>bio_conv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_conv_mgnbiot.html'>get_conv_mgnbiot</a></span><span class='op'>(</span>prm_biol <span class='op'>=</span> <span class='va'>prm_biol</span><span class='op'>)</span>

<span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'>calculate_consumed_biomass</span><span class='op'>(</span>eat <span class='op'>=</span> <span class='va'>ref_eat</span>, grazing <span class='op'>=</span> <span class='va'>ref_grazing</span>, dm <span class='op'>=</span> <span class='va'>ref_dm</span>,
                                 vol <span class='op'>=</span> <span class='va'>ref_vol</span>, bio_conv <span class='op'>=</span> <span class='va'>bio_conv</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>50% matching timesteps between PROD.nc and DietCheck.txt</span></div><div class='output co'>#&gt; <span class='warning'>Warning: `rename_()` was deprecated in dplyr 0.7.0.</span>
#&gt; <span class='warning'>Please use `rename()` instead.</span></div><div class='output co'>#&gt; <span class='warning'>Warning: `filter_()` was deprecated in dplyr 0.7.0.</span>
#&gt; <span class='warning'>Please use `filter()` instead.</span>
#&gt; <span class='warning'>See vignette('programming') for more help</span></div><div class='output co'>#&gt; <span class='message'>0.21% data is lost due to missing diet data despite available eat data.</span></div><div class='output co'>#&gt; <span class='message'>21.97% data is lost due to missing eat data despite available diet data.</span></div><div class='input'>
<span class='co'># 2. Read in dataframes from existing Atlantis simulation.</span>
<span class='va'>bboxes</span> <span class='op'>&lt;-</span> <span class='fu'><a href='get_boundary.html'>get_boundary</a></span><span class='op'>(</span>boxinfo <span class='op'>=</span> <span class='fu'><a href='load_box.html'>load_box</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>d</span>, <span class='st'>"VMPA_setas.bgm"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>nc_gen</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>d</span>, <span class='st'>"outputSETAS.nc"</span><span class='op'>)</span>
<span class='va'>nc_prod</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>d</span>, <span class='st'>"outputSETASPROD.nc"</span><span class='op'>)</span>
<span class='va'>prm_run</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>d</span>, <span class='st'>"VMPA_setas_run_fishing_F_Trunk.prm"</span><span class='op'>)</span>
<span class='va'>fgs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>d</span>, <span class='st'>"SETasGroupsDem_NoCep.csv"</span><span class='op'>)</span>
<span class='va'>init</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>d</span>, <span class='st'>"INIT_VMPA_Jan2015.nc"</span><span class='op'>)</span>

<span class='va'>bps</span> <span class='op'>&lt;-</span> <span class='fu'><a href='load_bps.html'>load_bps</a></span><span class='op'>(</span>fgs <span class='op'>=</span> <span class='va'>fgs</span>, init <span class='op'>=</span> <span class='va'>init</span><span class='op'>)</span>

<span class='va'>groups_age</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Planktiv_S_Fish"</span>, <span class='st'>"Pisciv_S_Fish"</span><span class='op'>)</span>
<span class='va'>groups_rest</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Cephalopod"</span>, <span class='st'>"Megazoobenthos"</span>, <span class='st'>"Diatom"</span>, <span class='st'>"Lab_Det"</span>, <span class='st'>"Ref_Det"</span><span class='op'>)</span>

<span class='va'>df_eat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='load_nc.html'>load_nc</a></span><span class='op'>(</span>nc <span class='op'>=</span> <span class='va'>nc_prod</span>, bps <span class='op'>=</span> <span class='va'>bps</span>, fgs <span class='op'>=</span> <span class='va'>fgs</span>,
               select_groups <span class='op'>=</span> <span class='va'>groups_age</span>, select_variable <span class='op'>=</span> <span class='st'>"Eat"</span>,
               prm_run <span class='op'>=</span> <span class='va'>prm_run</span>, bboxes <span class='op'>=</span> <span class='va'>bboxes</span><span class='op'>)</span>
<span class='va'>df_grz</span> <span class='op'>&lt;-</span> <span class='fu'><a href='load_nc.html'>load_nc</a></span><span class='op'>(</span>nc <span class='op'>=</span> <span class='va'>nc_prod</span>, bps <span class='op'>=</span> <span class='va'>bps</span>, fgs <span class='op'>=</span> <span class='va'>fgs</span>,
               select_groups <span class='op'>=</span> <span class='va'>groups_rest</span>, select_variable <span class='op'>=</span> <span class='st'>"Grazing"</span>,
               prm_run <span class='op'>=</span> <span class='va'>prm_run</span>, bboxes <span class='op'>=</span> <span class='va'>bboxes</span><span class='op'>)</span>
<span class='va'>df_dm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='load_dietcheck.html'>load_dietcheck</a></span><span class='op'>(</span>dietcheck <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>d</span>, <span class='st'>"outputSETASDietCheck.txt"</span><span class='op'>)</span>,
                        fgs <span class='op'>=</span> <span class='va'>fgs</span>, prm_run <span class='op'>=</span> <span class='va'>prm_run</span>, version_flag <span class='op'>=</span> <span class='fl'>2</span>, convert_names <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>vol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='load_nc_physics.html'>load_nc_physics</a></span><span class='op'>(</span>nc <span class='op'>=</span> <span class='va'>nc_gen</span>, select_physics <span class='op'>=</span> <span class='st'>"volume"</span>,
                       prm_run <span class='op'>=</span> <span class='va'>prm_run</span>, bboxes <span class='op'>=</span> <span class='va'>bboxes</span>, aggregate_layers <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'>calculate_consumed_biomass</span><span class='op'>(</span>eat <span class='op'>=</span> <span class='va'>df_eat</span>, grazing <span class='op'>=</span> <span class='va'>df_grz</span>, dm <span class='op'>=</span> <span class='va'>df_dm</span>,
                                 vol <span class='op'>=</span> <span class='va'>vol</span>, bio_conv <span class='op'>=</span> <span class='va'>bio_conv</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>50% matching timesteps between PROD.nc and DietCheck.txt</span></div><div class='output co'>#&gt; <span class='message'>11.61% data is lost due to missing diet data despite available eat data.</span></div><div class='output co'>#&gt; <span class='message'>21.97% data is lost due to missing eat data despite available diet data.</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alexander Keth, Andy Beet.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


