<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate spatially explicit biomass (in [t]) for each group and ageclass per timestep. — calculate_biomass_spatial • atlantistools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate spatially explicit biomass (in [t]) for each group and ageclass per timestep. — calculate_biomass_spatial" />
<meta property="og:description" content="Calculate spatially explicit biomass time series for each group and ageclass within
our model. Data is read in from 'output[...].nc'. Biomass for age-based groups is calculated
as (StructN [mgN] + ResN [mgN]) * Numbers [individuals]. Biomass for non age-based groups is
calculated as N [mgN] * volume [m^3] (sediment-dz [m] / volume [m^3] for epibenthic groups).
mgN is converted to t based on the stettings in the biol.prm file. Simulation time steps
are converted to time in years based on output timesteps given in run.prm." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">atlantistools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/model-calibration-species.html">model-calibration-species</a>
    </li>
    <li>
      <a href="../articles/model-calibration.html">model-calibration</a>
    </li>
    <li>
      <a href="../articles/model-comparison.html">model-comparison</a>
    </li>
    <li>
      <a href="../articles/model-preprocess.html">model-preprocess</a>
    </li>
    <li>
      <a href="../articles/package-demo.html">package-demo</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/alketh/atlantistools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate spatially explicit biomass (in [t]) for each group and ageclass per timestep.</h1>
    <small class="dont-index">Source: <a href='https://github.com/alketh/atlantistools/blob/master/R/calculate-biomass-spatial.R'><code>R/calculate-biomass-spatial.R</code></a></small>
    <div class="hidden name"><code>calculate_biomass_spatial.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculate spatially explicit biomass time series for each group and ageclass within
our model. Data is read in from 'output[...].nc'. Biomass for age-based groups is calculated
as (StructN [mgN] + ResN [mgN]) * Numbers [individuals]. Biomass for non age-based groups is
calculated as N [mgN] * volume [m^3] (sediment-dz [m] / volume [m^3] for epibenthic groups).
mgN is converted to t based on the stettings in the biol.prm file. Simulation time steps
are converted to time in years based on output timesteps given in run.prm.</p>
    </div>

    <pre class="usage"><span class='fu'>calculate_biomass_spatial</span>(<span class='no'>nums</span>, <span class='no'>sn</span>, <span class='no'>rn</span>, <span class='no'>n</span>, <span class='no'>vol_dz</span>, <span class='no'>bio_conv</span>, <span class='no'>bps</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>nums</th>
      <td><p>Dataframe with information about numbers for age-based groups.
Should be generated with <code><a href='load_nc.html'>load_nc</a></code>.</p></td>
    </tr>
    <tr>
      <th>sn</th>
      <td><p>Dataframe with information about structural nitrogen for age-based groups.
Should be generated with <code><a href='load_nc.html'>load_nc</a></code>.</p></td>
    </tr>
    <tr>
      <th>rn</th>
      <td><p>Dataframe with information about reserve nitrogen for age-based groups.
Should be generated with <code><a href='load_nc.html'>load_nc</a></code>.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>Dataframe with information about nitrogen for non-ge-based groups.
Should be generated with <code><a href='load_nc.html'>load_nc</a></code>.</p></td>
    </tr>
    <tr>
      <th>vol_dz</th>
      <td><p>Dataframe with information about volume and layer height per polygon.
Should be generated with <code><a href='load_nc_physics.html'>load_nc_physics</a></code>.</p></td>
    </tr>
    <tr>
      <th>bio_conv</th>
      <td><p>Numeric value to transform weight in mg N to tonnes.
Should be generated with <code><a href='get_conv_mgnbiot.html'>get_conv_mgnbiot</a></code>.</p></td>
    </tr>
    <tr>
      <th>bps</th>
      <td><p>Vector of character strings giving the complete list of epibenthic
functional groups (Only present in the sediment layer). The names have to match
the column 'Name' in the 'functionalGroups.csv' file.
Should be generated with <code><a href='load_bps.html'>load_bps</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Dataframe with columns 'species', 'agecl', 'polygon', 'layer', 'time'.
Biomass in [t] is stored in column 'atoutput'.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># 1. Using built in datasets.</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"extdata"</span>, <span class='st'>"setas-model-new-trunk"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"atlantistools"</span>)
<span class='no'>prm_biol</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>d</span>, <span class='st'>"VMPA_setas_biol_fishing_Trunk.prm"</span>)
<span class='no'>fgs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>d</span>, <span class='st'>"SETasGroupsDem_NoCep.csv"</span>)
<span class='no'>init</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>d</span>, <span class='st'>"INIT_VMPA_Jan2015.nc"</span>)
<span class='no'>bps</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='load_bps.html'>load_bps</a></span>(<span class='kw'>fgs</span> <span class='kw'>=</span> <span class='no'>fgs</span>, <span class='kw'>init</span> <span class='kw'>=</span> <span class='no'>init</span>)

<span class='no'>bio_conv</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='get_conv_mgnbiot.html'>get_conv_mgnbiot</a></span>(<span class='kw'>prm_biol</span> <span class='kw'>=</span> <span class='no'>prm_biol</span>)

<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'>calculate_biomass_spatial</span>(<span class='kw'>nums</span> <span class='kw'>=</span> <span class='no'>ref_nums</span>, <span class='kw'>sn</span> <span class='kw'>=</span> <span class='no'>ref_structn</span>, <span class='kw'>rn</span> <span class='kw'>=</span> <span class='no'>ref_resn</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='no'>ref_n</span>,
                                <span class='kw'>vol_dz</span> <span class='kw'>=</span> <span class='no'>ref_vol_dz</span>, <span class='kw'>bio_conv</span> <span class='kw'>=</span> <span class='no'>bio_conv</span>, <span class='kw'>bps</span> <span class='kw'>=</span> <span class='no'>bps</span>)

<span class='co'># 2. Read in dataframes from existing Atlantis simulation.</span>
<span class='no'>bboxes</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='get_boundary.html'>get_boundary</a></span>(<span class='kw'>boxinfo</span> <span class='kw'>=</span> <span class='fu'><a href='load_box.html'>load_box</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>d</span>, <span class='st'>"VMPA_setas.bgm"</span>)))
<span class='no'>nc_gen</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>d</span>, <span class='st'>"outputSETAS.nc"</span>)
<span class='no'>prm_run</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>d</span>, <span class='st'>"VMPA_setas_run_fishing_F_Trunk.prm"</span>)

<span class='no'>groups_age</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Planktiv_S_Fish"</span>, <span class='st'>"Pisciv_S_Fish"</span>)
<span class='no'>groups_rest</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Cephalopod"</span>, <span class='st'>"Megazoobenthos"</span>, <span class='st'>"Diatom"</span>, <span class='st'>"Lab_Det"</span>, <span class='st'>"Ref_Det"</span>)

<span class='no'>nums</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='load_nc.html'>load_nc</a></span>(<span class='kw'>nc</span> <span class='kw'>=</span> <span class='no'>nc_gen</span>, <span class='kw'>bps</span> <span class='kw'>=</span> <span class='no'>bps</span>, <span class='kw'>fgs</span> <span class='kw'>=</span> <span class='no'>fgs</span>,
                <span class='kw'>select_groups</span> <span class='kw'>=</span> <span class='no'>groups_age</span>, <span class='kw'>select_variable</span> <span class='kw'>=</span> <span class='st'>"Nums"</span>,
                <span class='kw'>prm_run</span> <span class='kw'>=</span> <span class='no'>prm_run</span>, <span class='kw'>bboxes</span> <span class='kw'>=</span> <span class='no'>bboxes</span>)
<span class='no'>sn</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='load_nc.html'>load_nc</a></span>(<span class='kw'>nc</span> <span class='kw'>=</span> <span class='no'>nc_gen</span>, <span class='kw'>bps</span> <span class='kw'>=</span> <span class='no'>bps</span>, <span class='kw'>fgs</span> <span class='kw'>=</span> <span class='no'>fgs</span>,
              <span class='kw'>select_groups</span> <span class='kw'>=</span> <span class='no'>groups_age</span>, <span class='kw'>select_variable</span> <span class='kw'>=</span> <span class='st'>"StructN"</span>,
              <span class='kw'>prm_run</span> <span class='kw'>=</span> <span class='no'>prm_run</span>, <span class='kw'>bboxes</span> <span class='kw'>=</span> <span class='no'>bboxes</span>)
<span class='no'>rn</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='load_nc.html'>load_nc</a></span>(<span class='kw'>nc</span> <span class='kw'>=</span> <span class='no'>nc_gen</span>, <span class='kw'>bps</span> <span class='kw'>=</span> <span class='no'>bps</span>, <span class='kw'>fgs</span> <span class='kw'>=</span> <span class='no'>fgs</span>,
              <span class='kw'>select_groups</span> <span class='kw'>=</span> <span class='no'>groups_age</span>, <span class='kw'>select_variable</span> <span class='kw'>=</span> <span class='st'>"ResN"</span>,
              <span class='kw'>prm_run</span> <span class='kw'>=</span> <span class='no'>prm_run</span>, <span class='kw'>bboxes</span> <span class='kw'>=</span> <span class='no'>bboxes</span>)
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='load_nc.html'>load_nc</a></span>(<span class='kw'>nc</span> <span class='kw'>=</span> <span class='no'>nc_gen</span>, <span class='kw'>bps</span> <span class='kw'>=</span> <span class='no'>bps</span>, <span class='kw'>fgs</span> <span class='kw'>=</span> <span class='no'>fgs</span>,
             <span class='kw'>select_groups</span> <span class='kw'>=</span> <span class='no'>groups_rest</span>, <span class='kw'>select_variable</span> <span class='kw'>=</span> <span class='st'>"N"</span>,
             <span class='kw'>prm_run</span> <span class='kw'>=</span> <span class='no'>prm_run</span>, <span class='kw'>bboxes</span> <span class='kw'>=</span> <span class='no'>bboxes</span>)
<span class='no'>vol</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='load_nc_physics.html'>load_nc_physics</a></span>(<span class='kw'>nc</span> <span class='kw'>=</span> <span class='no'>nc_gen</span>, <span class='kw'>select_physics</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"volume"</span>, <span class='st'>"dz"</span>),
                       <span class='kw'>prm_run</span> <span class='kw'>=</span> <span class='no'>prm_run</span>, <span class='kw'>bboxes</span> <span class='kw'>=</span> <span class='no'>bboxes</span>, <span class='kw'>aggregate_layers</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'>calculate_biomass_spatial</span>(<span class='kw'>nums</span> <span class='kw'>=</span> <span class='no'>nums</span>, <span class='kw'>sn</span> <span class='kw'>=</span> <span class='no'>sn</span>, <span class='kw'>rn</span> <span class='kw'>=</span> <span class='no'>rn</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='no'>n</span>, <span class='kw'>vol_dz</span> <span class='kw'>=</span> <span class='no'>vol</span>,
                                <span class='kw'>bio_conv</span> <span class='kw'>=</span> <span class='no'>bio_conv</span>, <span class='kw'>bps</span> <span class='kw'>=</span> <span class='no'>bps</span>)

<span class='co'># 3. Read in dataframes from existing Atlantis simulation with Map().</span>
<span class='no'>vars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='st'>"Nums"</span>, <span class='st'>"StructN"</span>, <span class='st'>"ResN"</span>, <span class='st'>"N"</span>)
<span class='no'>grps</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>groups_age</span>, <span class='no'>groups_age</span>, <span class='no'>groups_age</span>, <span class='no'>groups_rest</span>)
<span class='no'>dfs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Map</a></span>(<span class='no'>load_nc</span>, <span class='kw'>select_variable</span> <span class='kw'>=</span> <span class='no'>vars</span>, <span class='kw'>select_groups</span> <span class='kw'>=</span> <span class='no'>grps</span>,
           <span class='kw'>MoreArgs</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>nc</span> <span class='kw'>=</span> <span class='no'>nc_gen</span>, <span class='kw'>bps</span> <span class='kw'>=</span> <span class='no'>bps</span>, <span class='kw'>fgs</span> <span class='kw'>=</span> <span class='no'>fgs</span>,
                           <span class='kw'>prm_run</span> <span class='kw'>=</span> <span class='no'>prm_run</span>, <span class='kw'>bboxes</span> <span class='kw'>=</span> <span class='no'>bboxes</span>))

<span class='no'>df</span> <span class='kw'>&lt;-</span> <span class='fu'>calculate_biomass_spatial</span>(<span class='kw'>nums</span> <span class='kw'>=</span> <span class='no'>dfs</span><span class='kw'>[[</span><span class='fl'>1</span>]], <span class='kw'>sn</span> <span class='kw'>=</span> <span class='no'>dfs</span><span class='kw'>[[</span><span class='fl'>2</span>]], <span class='kw'>rn</span> <span class='kw'>=</span> <span class='no'>dfs</span><span class='kw'>[[</span><span class='fl'>3</span>]], <span class='kw'>n</span> <span class='kw'>=</span> <span class='no'>dfs</span><span class='kw'>[[</span><span class='fl'>4</span>]],
                                <span class='kw'>vol_dz</span> <span class='kw'>=</span> <span class='no'>vol</span>, <span class='kw'>bio_conv</span> <span class='kw'>=</span> <span class='no'>bio_conv</span>, <span class='kw'>bps</span> <span class='kw'>=</span> <span class='no'>bps</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alexander Keth.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


