<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>package-demo • atlantistools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="package-demo">
<meta property="og:description" content="atlantistools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">atlantistools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/atlantistools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model-calibration-species.html">model-calibration-species</a>
    </li>
    <li>
      <a href="../articles/model-calibration.html">model-calibration</a>
    </li>
    <li>
      <a href="../articles/model-comparison.html">model-comparison</a>
    </li>
    <li>
      <a href="../articles/model-preprocess.html">model-preprocess</a>
    </li>
    <li>
      <a href="../articles/package-demo.html">package-demo</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Atlantis-Ecosystem-Model/atlantistools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="package-demo_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>package-demo</h1>
                        <h4 class="author">Alexander Keth</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Atlantis-Ecosystem-Model/atlantistools/blob/master/vignettes/package-demo.Rmd"><code>vignettes/package-demo.Rmd</code></a></small>
      <div class="hidden name"><code>package-demo.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/Atlantis-Ecosystem-Model/atlantistools">"atlantistools"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"gridExtra"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following object is masked from 'package:gridExtra':
## 
##     combine</code></pre>
<pre><code>## The following object is masked from 'package:atlantistools':
## 
##     group_data</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"setas-model-new-trunk"</span>, package <span class="op">=</span> <span class="st">"atlantistools"</span><span class="op">)</span></code></pre></div>
<div id="read-in-output-from-netcdf-files-with-load_nc-and-load_nc_physics" class="section level2">
<h2 class="hasAnchor">
<a href="#read-in-output-from-netcdf-files-with-load_nc-and-load_nc_physics" class="anchor"></a>Read in output from netcdf files with <code>load_nc</code> and <code>load_nc_physics</code>
</h2>
<p>The first step with <code>atlantistools</code> is the extraction of data from the atlantis simulation. Data is transformed following the ‘tidy-dataframe’ framework from Hadley Wickham. Output from various variables (individual weight, physics, consumption…) is standardised to a uniform format. To further simplify subsequent analysis the following transformations are applied: - Simulation time is standardised to time in years. - Group names are converted according to the colum ‘LongName’ in the functional groups file. - Data from boundary boxes and islands is removed. - Data from non existent layers is removed. - Values are stored in the column ‘atoutput’.</p>
</div>
<div id="extract-numbers-per-species-timestep-polygon-layer-and-ageclass" class="section level1">
<h1 class="hasAnchor">
<a href="#extract-numbers-per-species-timestep-polygon-layer-and-ageclass" class="anchor"></a>Extract numbers per species, timestep, polygon, layer and ageclass</h1>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nums</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETAS.nc"</span><span class="op">)</span>, 
                fgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"SETasGroupsDem_NoCep.csv"</span><span class="op">)</span>, 
                bps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Filter_Shallow"</span>, <span class="st">"Filter_Other"</span>, <span class="st">"Filter_Deep"</span>, <span class="st">"Benthic_grazer"</span>, 
                        <span class="st">"Macrobenth_Deep"</span>, <span class="st">"Megazoobenthos"</span>, <span class="st">"Macrobenth_Shallow"</span>, <span class="st">"Macroalgae"</span><span class="op">)</span>, 
                select_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Planktiv_S_Fish"</span>, <span class="st">"Pisciv_S_Fish"</span><span class="op">)</span>, 
                select_variable <span class="op">=</span> <span class="st">"Nums"</span>, 
                prm_run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_run_fishing_F_Trunk.prm"</span><span class="op">)</span>, 
                bboxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="extract-structural-nitrogen-per-species-timestep-polygon-layer-and-ageclass" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-structural-nitrogen-per-species-timestep-polygon-layer-and-ageclass" class="anchor"></a>Extract structural nitrogen per species, timestep, polygon, layer and ageclass</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">structn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETAS.nc"</span><span class="op">)</span>, 
                fgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"SETasGroupsDem_NoCep.csv"</span><span class="op">)</span>,  
                   bps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Filter_Shallow"</span>, <span class="st">"Filter_Other"</span>, <span class="st">"Filter_Deep"</span>, <span class="st">"Benthic_grazer"</span>, 
                           <span class="st">"Macrobenth_Deep"</span>, <span class="st">"Megazoobenthos"</span>, <span class="st">"Macrobenth_Shallow"</span>, <span class="st">"Macroalgae"</span><span class="op">)</span>, 
                   select_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Planktiv_S_Fish"</span>, <span class="st">"Pisciv_S_Fish"</span><span class="op">)</span>, 
                   select_variable <span class="op">=</span> <span class="st">"StructN"</span>, 
                   prm_run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_run_fishing_F_Trunk.prm"</span><span class="op">)</span>, 
                   bboxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="use-build-in-functions-to-extract-epibenthic-groups-and-boundary-boxes" class="section level2">
<h2 class="hasAnchor">
<a href="#use-build-in-functions-to-extract-epibenthic-groups-and-boundary-boxes" class="anchor"></a>Use build in functions to extract epibenthic groups and boundary boxes</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">boundary_boxes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_boundary.html">get_boundary</a></span><span class="op">(</span>boxinfo <span class="op">=</span> <span class="fu"><a href="../reference/load_box.html">load_box</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas.bgm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">epibenthic_groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_bps.html">load_bps</a></span><span class="op">(</span>fgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"SETasGroupsDem_NoCep.csv"</span><span class="op">)</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"INIT_VMPA_Jan2015.nc"</span><span class="op">)</span><span class="op">)</span>

<span class="va">resn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETAS.nc"</span><span class="op">)</span>, 
                fgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"SETasGroupsDem_NoCep.csv"</span><span class="op">)</span>, 
                bps <span class="op">=</span> <span class="va">epibenthic_groups</span>, 
                select_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Planktiv_S_Fish"</span>, <span class="st">"Pisciv_S_Fish"</span><span class="op">)</span>, 
                select_variable <span class="op">=</span> <span class="st">"ResN"</span>, 
                prm_run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_run_fishing_F_Trunk.prm"</span><span class="op">)</span>, 
                bboxes <span class="op">=</span> <span class="va">boundary_boxes</span><span class="op">)</span></code></pre></div>
</div>
<div id="extract-consumption-from-non-age-based-groups-species-timestep-and-polygon" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-consumption-from-non-age-based-groups-species-timestep-and-polygon" class="anchor"></a>Extract consumption from non-age-based groups species, timestep and polygon</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grazing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETASPROD.nc"</span><span class="op">)</span>, 
                   fgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"SETasGroupsDem_NoCep.csv"</span><span class="op">)</span>, 
                   bps <span class="op">=</span> <span class="va">epibenthic_groups</span>, 
                   select_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Megazoobenthos"</span>, <span class="st">"Cephalopod"</span><span class="op">)</span>, 
                   select_variable <span class="op">=</span> <span class="st">"Grazing"</span>, 
                   prm_run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_run_fishing_F_Trunk.prm"</span><span class="op">)</span>, 
                   bboxes <span class="op">=</span> <span class="va">boundary_boxes</span><span class="op">)</span></code></pre></div>
</div>
<div id="extract-volume-per-polygon-layer-and-timestep-" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-volume-per-polygon-layer-and-timestep-" class="anchor"></a>Extract Volume per polygon, layer and timestep.</h2>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">physics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc_physics.html">load_nc_physics</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETAS.nc"</span><span class="op">)</span>, select_physics <span class="op">=</span> <span class="st">"volume"</span>, 
                           prm_run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_run_fishing_F_Trunk.prm"</span><span class="op">)</span>,
                           bboxes <span class="op">=</span> <span class="va">boundary_boxes</span>, aggregate_layers <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>All filenames used in the <code>load</code> functions have to be passed as character string giving the connection to the specific files. The easiest way to use <code>atlantistools</code> is to define the Atlantis directory as working directory in your R session. By doing so, you can simply pass the filenames themselfes. like:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">structn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="st">"outputSETAS.nc"</span>, 
                   fgs <span class="op">=</span> <span class="st">"SETasGroupsDem_NoCep.csv"</span>, 
                   bps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Filter_Shallow"</span>, <span class="st">"Filter_Other"</span>, <span class="st">"Filter_Deep"</span>, <span class="st">"Benthic_grazer"</span>, 
                           <span class="st">"Macrobenth_Deep"</span>, <span class="st">"Megazoobenthos"</span>, <span class="st">"Macrobenth_Shallow"</span>, <span class="st">"Macroalgae"</span><span class="op">)</span>, 
                   select_groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Planktiv_S_Fish"</span>, <span class="st">"Pisciv_S_Fish"</span><span class="op">)</span>, 
                   select_variable <span class="op">=</span> <span class="st">"StructN"</span>, 
                   prm_run <span class="op">=</span> <span class="st">"VMPA_setas_run_fishing_F_Trunk.prm"</span>, 
                   bboxes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>In case you work within a R project all those filenames can be easily auto-completed with the <code>tab</code> key.</p>
<p>In case you are using different folders for generic model files and output files you need to implement the output subfolder into the name of your outputfiles (this is done automatically via auto completion within a R project):</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>structn &lt;-<span class="st"> </span><span class="kw">load_nc</span>(<span class="dt">nc =</span> <span class="st">"output\outputSETAS.nc"</span>, </span>
<span id="cb14-2"><a href="#cb14-2"></a>                   <span class="dt">fgs =</span> <span class="st">"SETasGroupsDem_NoCep.csv"</span>, </span>
<span id="cb14-3"><a href="#cb14-3"></a>                   <span class="dt">bps =</span> <span class="kw">c</span>(<span class="st">"Filter_Shallow"</span>, <span class="st">"Filter_Other"</span>, <span class="st">"Filter_Deep"</span>, <span class="st">"Benthic_grazer"</span>, </span>
<span id="cb14-4"><a href="#cb14-4"></a>                           <span class="st">"Macrobenth_Deep"</span>, <span class="st">"Megazoobenthos"</span>, <span class="st">"Macrobenth_Shallow"</span>, <span class="st">"Macroalgae"</span>), </span>
<span id="cb14-5"><a href="#cb14-5"></a>                   <span class="dt">select_groups =</span> <span class="kw">c</span>(<span class="st">"Planktiv_S_Fish"</span>, <span class="st">"Pisciv_S_Fish"</span>), </span>
<span id="cb14-6"><a href="#cb14-6"></a>                   <span class="dt">select_variable =</span> <span class="st">"StructN"</span>, </span>
<span id="cb14-7"><a href="#cb14-7"></a>                   <span class="dt">prm_run =</span> <span class="st">"VMPA_setas_run_fishing_F_Trunk.prm"</span>, </span>
<span id="cb14-8"><a href="#cb14-8"></a>                   <span class="dt">bboxes =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>))</span></code></pre></div>
<p>Unfortunately, it is not advised to change the directory within a vignette. Sadly, the demo vignette has to be stored in a different location as the example model files which come shipped with <code>atlantistools</code> making it nearly impossible to demonstrate the proper function calls inside the vignette.</p>
</div>
<div id="atlantistools-offers-a-set-of-functions-to-calculate-model-diagnostics-" class="section level2">
<h2 class="hasAnchor">
<a href="#atlantistools-offers-a-set-of-functions-to-calculate-model-diagnostics-" class="anchor"></a>Atlantistools offers a set of functions to calculate model diagnostics.</h2>
<p>Use <code>calculate_biomass_spatial</code> to calculate the biomass in tonnes over time for each group and ageclass per polygon and layer.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bboxes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_boundary.html">get_boundary</a></span><span class="op">(</span>boxinfo <span class="op">=</span> <span class="fu"><a href="../reference/load_box.html">load_box</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas.bgm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">nc_gen</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETAS.nc"</span><span class="op">)</span>
<span class="va">nc_prod</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETASPROD.nc"</span><span class="op">)</span>
<span class="va">prm_run</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_run_fishing_F_Trunk.prm"</span><span class="op">)</span>
<span class="va">prm_biol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_biol_fishing_Trunk.prm"</span><span class="op">)</span>
<span class="va">fgs</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"SETasGroupsDem_NoCep.csv"</span><span class="op">)</span>
<span class="va">bps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_bps.html">load_bps</a></span><span class="op">(</span>fgs <span class="op">=</span> <span class="va">fgs</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"INIT_VMPA_Jan2015.nc"</span><span class="op">)</span><span class="op">)</span>
<span class="va">bio_conv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_conv_mgnbiot.html">get_conv_mgnbiot</a></span><span class="op">(</span>prm_biol <span class="op">=</span> <span class="va">prm_biol</span><span class="op">)</span>

<span class="va">groups_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Planktiv_S_Fish"</span>, <span class="st">"Pisciv_S_Fish"</span><span class="op">)</span>
<span class="va">groups_rest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cephalopod"</span>, <span class="st">"Megazoobenthos"</span>, <span class="st">"Diatom"</span>, <span class="st">"Lab_Det"</span>, <span class="st">"Ref_Det"</span><span class="op">)</span>

<span class="va">nums</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="va">nc_gen</span>, bps <span class="op">=</span> <span class="va">bps</span>, fgs <span class="op">=</span> <span class="va">fgs</span>,
                select_groups <span class="op">=</span> <span class="va">groups_age</span>, select_variable <span class="op">=</span> <span class="st">"Nums"</span>,
                prm_run <span class="op">=</span> <span class="va">prm_run</span>, bboxes <span class="op">=</span> <span class="va">bboxes</span><span class="op">)</span>
<span class="va">sn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="va">nc_gen</span>, bps <span class="op">=</span> <span class="va">bps</span>, fgs <span class="op">=</span> <span class="va">fgs</span>,
              select_groups <span class="op">=</span> <span class="va">groups_age</span>, select_variable <span class="op">=</span> <span class="st">"StructN"</span>,
              prm_run <span class="op">=</span> <span class="va">prm_run</span>, bboxes <span class="op">=</span> <span class="va">bboxes</span><span class="op">)</span>
<span class="va">rn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="va">nc_gen</span>, bps <span class="op">=</span> <span class="va">bps</span>, fgs <span class="op">=</span> <span class="va">fgs</span>,
              select_groups <span class="op">=</span> <span class="va">groups_age</span>, select_variable <span class="op">=</span> <span class="st">"ResN"</span>,
              prm_run <span class="op">=</span> <span class="va">prm_run</span>, bboxes <span class="op">=</span> <span class="va">bboxes</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="va">nc_gen</span>, bps <span class="op">=</span> <span class="va">bps</span>, fgs <span class="op">=</span> <span class="va">fgs</span>,
             select_groups <span class="op">=</span> <span class="va">groups_rest</span>, select_variable <span class="op">=</span> <span class="st">"N"</span>,
             prm_run <span class="op">=</span> <span class="va">prm_run</span>, bboxes <span class="op">=</span> <span class="va">bboxes</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: `summarise_()` was deprecated in dplyr 0.7.0.
## Please use `summarise()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: `group_by_()` was deprecated in dplyr 0.7.0.
## Please use `group_by()` instead.
## See vignette('programming') for more help
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc_physics.html">load_nc_physics</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="va">nc_gen</span>, select_physics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"volume"</span>, <span class="st">"dz"</span><span class="op">)</span>,
                       prm_run <span class="op">=</span> <span class="va">prm_run</span>, bboxes <span class="op">=</span> <span class="va">bboxes</span>, aggregate_layers <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="va">df_bio_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_biomass_spatial.html">calculate_biomass_spatial</a></span><span class="op">(</span>nums <span class="op">=</span> <span class="va">nums</span>, sn <span class="op">=</span> <span class="va">sn</span>, rn <span class="op">=</span> <span class="va">rn</span>, n <span class="op">=</span> <span class="va">n</span>, vol_dz <span class="op">=</span> <span class="va">vol</span>,
                                            bio_conv <span class="op">=</span> <span class="va">bio_conv</span>, bps <span class="op">=</span> <span class="va">bps</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: `select_()` was deprecated in dplyr 0.7.0.
## Please use `select()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: `mutate_()` was deprecated in dplyr 0.7.0.
## Please use `mutate()` instead.
## See vignette('programming') for more help
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<p>Use <code>calculate_consumed_biomass</code> to calculate the consumed biomass of each prey species in tonnes by each predator and ageclass per timestep and polygon.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bboxes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_boundary.html">get_boundary</a></span><span class="op">(</span>boxinfo <span class="op">=</span> <span class="fu"><a href="../reference/load_box.html">load_box</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas.bgm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">nc_gen</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETAS.nc"</span><span class="op">)</span>
<span class="va">nc_prod</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETASPROD.nc"</span><span class="op">)</span>
<span class="va">prm_run</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_run_fishing_F_Trunk.prm"</span><span class="op">)</span>
<span class="va">prm_biol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_biol_fishing_Trunk.prm"</span><span class="op">)</span>
<span class="va">fgs</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"SETasGroupsDem_NoCep.csv"</span><span class="op">)</span>
<span class="va">bps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_bps.html">load_bps</a></span><span class="op">(</span>fgs <span class="op">=</span> <span class="va">fgs</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"INIT_VMPA_Jan2015.nc"</span><span class="op">)</span><span class="op">)</span>
<span class="va">bio_conv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_conv_mgnbiot.html">get_conv_mgnbiot</a></span><span class="op">(</span>prm_biol <span class="op">=</span> <span class="va">prm_biol</span><span class="op">)</span>

<span class="va">groups_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Planktiv_S_Fish"</span>, <span class="st">"Pisciv_S_Fish"</span><span class="op">)</span>
<span class="va">groups_rest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Cephalopod"</span>, <span class="st">"Megazoobenthos"</span>, <span class="st">"Diatom"</span>, <span class="st">"Lab_Det"</span>, <span class="st">"Ref_Det"</span><span class="op">)</span>

<span class="va">df_eat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="va">nc_prod</span>, bps <span class="op">=</span> <span class="va">bps</span>, fgs <span class="op">=</span> <span class="va">fgs</span>,
               select_groups <span class="op">=</span> <span class="va">groups_age</span>, select_variable <span class="op">=</span> <span class="st">"Eat"</span>,
               prm_run <span class="op">=</span> <span class="va">prm_run</span>, bboxes <span class="op">=</span> <span class="va">bboxes</span><span class="op">)</span>
<span class="va">df_grz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="va">nc_prod</span>, bps <span class="op">=</span> <span class="va">bps</span>, fgs <span class="op">=</span> <span class="va">fgs</span>,
               select_groups <span class="op">=</span> <span class="va">groups_rest</span>, select_variable <span class="op">=</span> <span class="st">"Grazing"</span>,
               prm_run <span class="op">=</span> <span class="va">prm_run</span>, bboxes <span class="op">=</span> <span class="va">bboxes</span><span class="op">)</span>
<span class="va">df_dm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_dietcheck.html">load_dietcheck</a></span><span class="op">(</span>dietcheck <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"outputSETASDietCheck.txt"</span><span class="op">)</span>,
                        fgs <span class="op">=</span> <span class="va">fgs</span>, prm_run <span class="op">=</span> <span class="va">prm_run</span>, version_flag <span class="op">=</span> <span class="fl">2</span>, convert_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc_physics.html">load_nc_physics</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="va">nc_gen</span>, select_physics <span class="op">=</span> <span class="st">"volume"</span>,
                       prm_run <span class="op">=</span> <span class="va">prm_run</span>, bboxes <span class="op">=</span> <span class="va">bboxes</span>, aggregate_layers <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="va">df_cons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_consumed_biomass.html">calculate_consumed_biomass</a></span><span class="op">(</span>eat <span class="op">=</span> <span class="va">df_eat</span>, grazing <span class="op">=</span> <span class="va">df_grz</span>, dm <span class="op">=</span> <span class="va">df_dm</span>,
                                      vol <span class="op">=</span> <span class="va">vol</span>, bio_conv <span class="op">=</span> <span class="va">bio_conv</span><span class="op">)</span></code></pre></div>
<pre><code>## 50% matching timesteps between PROD.nc and DietCheck.txt</code></pre>
<pre><code>## Warning: `rename_()` was deprecated in dplyr 0.7.0.
## Please use `rename()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: `filter_()` was deprecated in dplyr 0.7.0.
## Please use `filter()` instead.
## See vignette('programming') for more help
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## 11.61% data is lost due to missing diet data despite available eat data.</code></pre>
<pre><code>## 21.97% data is lost due to missing eat data despite available diet data.</code></pre>
</div>
<div id="atlantistools-offers-a-wide-variety-of-plotting-functions-to-visualise-atlantis-simulations" class="section level2">
<h2 class="hasAnchor">
<a href="#atlantistools-offers-a-wide-variety-of-plotting-functions-to-visualise-atlantis-simulations" class="anchor"></a>atlantistools offers a wide variety of plotting functions to visualise Atlantis simulations</h2>
<p>The two major plotting functions are <code>plot_line</code> to visualise time-series and <code>plot_bar</code>. Each plot in <code>atlantistools</code> either returns a ggplot2 object or a table-grob composed of individual ggplot2 objects. Therefore, you are able to customise the plots to your personal liking afterwards.</p>
</div>
<div id="plot_line-can-be-used-in-various-ways" class="section level2">
<h2 class="hasAnchor">
<a href="#plot_line-can-be-used-in-various-ways" class="anchor"></a><code>plot_line</code> can be used in various ways</h2>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aggregate spatial biomass!</span>
<span class="va">biomass</span> <span class="op">&lt;-</span> <span class="va">df_bio_spatial</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/agg_data.html">agg_data</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"time"</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">sum</span><span class="op">)</span>

<span class="fu"><a href="../reference/plot_line.html">plot_line</a></span><span class="op">(</span><span class="va">biomass</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_line.html">plot_line</a></span><span class="op">(</span><span class="va">biomass</span>, col <span class="op">=</span> <span class="st">"species"</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aggregate spatial biomass for fully age structured groups!</span>
<span class="va">biomass_age</span> <span class="op">&lt;-</span> <span class="va">df_bio_spatial</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">agecl</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/agg_data.html">agg_data</a></span><span class="op">(</span>groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"agecl"</span>, <span class="st">"time"</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">sum</span><span class="op">)</span>

<span class="fu"><a href="../reference/plot_line.html">plot_line</a></span><span class="op">(</span><span class="va">biomass_age</span>, col <span class="op">=</span> <span class="st">"agecl"</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-11-3.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_line.html">plot_line</a></span><span class="op">(</span><span class="va">biomass_age</span>, wrap <span class="op">=</span> <span class="st">"agecl"</span>, col <span class="op">=</span> <span class="st">"species"</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-11-4.png" width="700"></p>
<p>Compare model outoput with observed data.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ex_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"setas-model-new-becdev"</span>, package <span class="op">=</span> <span class="st">"atlantistools"</span><span class="op">)</span>, 
                              <span class="st">"setas-bench.csv"</span><span class="op">)</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ex_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ex_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"biomass"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"atoutput"</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="va">biomass</span>
<span class="va">data</span><span class="op">$</span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">"atlantis"</span>
<span class="va">comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">ex_data</span>, <span class="va">data</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Show atlantis as first factor!</span>
<span class="va">comp</span><span class="op">$</span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">comp</span><span class="op">$</span><span class="va">model</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"atlantis"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">comp</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">comp</span><span class="op">$</span><span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"atlantis"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Create plot</span>
<span class="fu"><a href="../reference/plot_line.html">plot_line</a></span><span class="op">(</span><span class="va">comp</span>, col <span class="op">=</span> <span class="st">"model"</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use convert_relative_initial and {plot_add_box with plot_line.</span>
<span class="co"># Firstly, use convert_relative_initial to generate a relative time series first.</span>
<span class="co"># Aggregate the polygon and layer based data first.</span>
<span class="va">structn_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agg_data.html">agg_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">structn</span>,  groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"time"</span>, <span class="st">"agecl"</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_relative_initial.html">convert_relative_initial</a></span><span class="op">(</span><span class="va">structn_age</span><span class="op">)</span>

<span class="co"># Create the base plot with plot_line.</span>
<span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_line.html">plot_line</a></span><span class="op">(</span><span class="va">df</span>, col <span class="op">=</span> <span class="st">"agecl"</span><span class="op">)</span>

<span class="co"># Add lower and upper range.</span>
<span class="fu"><a href="../reference/plot_add_box.html">plot_add_box</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># You can set the upper and lower range of the box as you like!</span>
<span class="fu"><a href="../reference/plot_add_box.html">plot_add_box</a></span><span class="op">(</span><span class="va">plot</span>, range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-13-2.png" width="700"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create spatial timeseries plots in conjuction with custom_grid to plot physics data.</span>
<span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_line.html">plot_line</a></span><span class="op">(</span><span class="va">ref_physics</span>, wrap <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="fu"><a href="../reference/custom_grid.html">custom_grid</a></span><span class="op">(</span><span class="va">plot</span>, grid_x <span class="op">=</span> <span class="st">"polygon"</span>, grid_y <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">flux</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc_physics.html">load_nc_physics</a></span><span class="op">(</span>nc <span class="op">=</span> <span class="va">nc_gen</span>, select_physics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"eflux"</span>, <span class="st">"vflux"</span><span class="op">)</span>,
                        prm_run <span class="op">=</span> <span class="va">prm_run</span>, bboxes <span class="op">=</span> <span class="va">bboxes</span>, aggregate_layers <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_line.html">plot_line</a></span><span class="op">(</span><span class="va">flux</span>, wrap <span class="op">=</span> <span class="cn">NULL</span>, col <span class="op">=</span> <span class="st">"variable"</span><span class="op">)</span>
<span class="fu"><a href="../reference/custom_grid.html">custom_grid</a></span><span class="op">(</span><span class="va">plot</span>, grid_x <span class="op">=</span> <span class="st">"polygon"</span>, grid_y <span class="op">=</span> <span class="st">"layer"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 12 row(s) containing missing values (geom_path).</code></pre>
<p><img src="package-demo_files/figure-html/unnamed-chunk-14-2.png" width="700"></p>
</div>
<div id="create-a-map-of-your-model-for-bec" class="section level2">
<h2 class="hasAnchor">
<a href="#create-a-map-of-your-model-for-bec" class="anchor"></a>Create a map of your model for Bec!</h2>
<p>Always add a spatial representation of your model if you have issues with model tuning. This makes the life of Bec and Beth much easier.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bgm_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convert_bgm.html">convert_bgm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas.bgm"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_boxes.html">plot_boxes</a></span><span class="op">(</span><span class="va">bgm_data</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Aggregate numbers.</span>
<span class="va">nums_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agg_data.html">agg_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nums</span>, groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"agecl"</span>, <span class="st">"time"</span><span class="op">)</span>, fun <span class="op">=</span> <span class="va">sum</span><span class="op">)</span>

<span class="co"># Use agg_perc together with plot_bar to visualise the relative cohort structure over time.</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agg_data.html">agg_perc</a></span><span class="op">(</span><span class="va">nums_age</span>, groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_bar.html">plot_bar</a></span><span class="op">(</span><span class="va">df</span>, fill <span class="op">=</span> <span class="st">"agecl"</span>, wrap <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 20 rows containing missing values (position_stack).</code></pre>
<p><img src="package-demo_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/agg_data.html">agg_perc</a></span><span class="op">(</span><span class="va">biomass_age</span>, groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot_bar.html">plot_bar</a></span><span class="op">(</span><span class="va">df</span>, fill <span class="op">=</span> <span class="st">"agecl"</span>, wrap <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 16 rows containing missing values (position_stack).</code></pre>
<p><img src="package-demo_files/figure-html/unnamed-chunk-16-2.png" width="700"></p>
</div>
<div id="plot-feeding-interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-feeding-interactions" class="anchor"></a>Plot feeding interactions</h2>
<p>Please note the plots will look much nicer if the simulation period is elongated. I only ran the SETAS model provided with <code>atlantistools</code> for 3 years to minimise the size of the package.</p>
<p>Data about feeding interactions can be visualised with <code>plot_diet</code> (Please use <code>plot_diet_bec_dev</code> for bec-dev models. However, in contrast to trunk models the plots will only give an indication about feeding interacions. They do not show the actual consumed biomass). The data originates from <code>DietCheck.txt</code>.</p>
<p>The plots are stored as a list of table-grob. You can plot them on the graphics device with <code><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">gridExtra::grid.arrange</a></code>.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">feeding_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_diet.html">plot_diet</a></span><span class="op">(</span><span class="va">df_cons</span>, wrap_col <span class="op">=</span> <span class="st">"agecl"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: `arrange_()` was deprecated in dplyr 0.7.0.
## Please use `arrange()` instead.
## See vignette('programming') for more help
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Joining, by = c("time", "pred", "agecl", "prey")
## Joining, by = c("time", "pred", "agecl", "prey")</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">feeding_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">feeding_plots</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="package-demo_files/figure-html/unnamed-chunk-17-2.png" width="700"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Apply names() to the list of table-grobs to extract the predator name</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">feeding_plots</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Carrion3"                 "Cephalopod"              
## [3] "Diatom"                   "Labile detritus"         
## [5] "Megazoobenthos"           "Refractory detritus"     
## [7] "Shallow piscivorous fish" "Small planktivorous fish"</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Save all plots to disc in multiple pdfs!</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">feeding_plots</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"feeding"</span>, <span class="va">i</span>, <span class="st">".pdf"</span><span class="op">)</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">14</span>, height <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">feeding_plots</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Save all plots to disc in one pdf!</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"feeding.pdf"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">14</span>, height <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">marrangeGrob</a></span><span class="op">(</span><span class="va">feeding_plots</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="change-parameter-values" class="section level2">
<h2 class="hasAnchor">
<a href="#change-parameter-values" class="anchor"></a>Change parameter values!</h2>
<p>Let’s say you want to change a parameter in your biological parameter file. For example the recruit weights for a specific fish. In our case <code>Small planktivorous fish</code> (Code = <code>FPS</code>). You can either change the existing valu by multiplication with a factor or set a new absolut value. In our case we increase the existing value by a factor of 2.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_prm</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/change_prm.html">change_prm</a></span><span class="op">(</span>prm_biol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_biol_fishing_Trunk.prm"</span><span class="op">)</span>, 
                       select_acronyms <span class="op">=</span> <span class="st">"FPS"</span>, 
                       roc <span class="op">=</span> <span class="fl">2</span>, 
                       parameter <span class="op">=</span> <span class="st">"KWRR"</span>, 
                       save_to_disc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>You can use <code>extract_prm</code> to check the format of the resulting *.prm. However, I checked the function thoroughly so you would normally set <code>save_to_disc</code> to <code>TRUE</code> to overwrite your existing parameter file with the newly generated one Please make sure to backup your original files beforehand.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/extract_prm.html">extract_prm</a></span><span class="op">(</span>prm_biol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_biol_fishing_Trunk.prm"</span><span class="op">)</span>, variables <span class="op">=</span> <span class="st">"KWRR_FPS"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.075</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/extract_prm.html">extract_prm</a></span><span class="op">(</span>prm_biol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_biol_fishing_Trunk.prm"</span><span class="op">)</span>, variables <span class="op">=</span> <span class="st">"KWSR_FPS"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.028</code></pre>
<p>You can also pass a vector of groups to change the parameter for multiple functional groups with a single call to <code>change_prm</code>.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_prm</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/change_prm.html">change_prm</a></span><span class="op">(</span>prm_biol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_biol_fishing_Trunk.prm"</span><span class="op">)</span>, 
                       select_acronyms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FPL"</span>, <span class="st">"FPO"</span>, <span class="st">"FPS"</span>, <span class="st">"FVD"</span>, <span class="st">"FVV"</span>, <span class="st">"FVS"</span>, <span class="st">"FVB"</span>, <span class="st">"FVT"</span>, <span class="st">"FVO"</span><span class="op">)</span>, 
                       roc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span>, min <span class="op">=</span> <span class="fl">2</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, 
                       parameter <span class="op">=</span> <span class="st">"KWRR"</span>, 
                       save_to_disc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>This helps to automate the tuning and calibration of your model. In addition it is a useful tool to make the tuning reproduceable and transparent for other modelers.</p>
<p>In case you want to change the parameter values for cohort structured groups with multiple values per parameter (E.g. Clearance rate and mum for fish groups) please use <code>change_prm_cohrt</code>. Please note that the function only works with parameters whose values are stored in the next row following the flag in the *.prm file.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_prm</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/change_prm_cohort.html">change_prm_cohort</a></span><span class="op">(</span>prm_biol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">"VMPA_setas_biol_fishing_Trunk.prm"</span><span class="op">)</span>, 
                              select_acronyms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FPL"</span>, <span class="st">"FPO"</span><span class="op">)</span>, 
                              roc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, times <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, 
                              parameter <span class="op">=</span> <span class="st">"C"</span>, 
                              save_to_disc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alexander Keth, Andy Beet.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
